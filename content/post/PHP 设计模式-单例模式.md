---
title: "PHP 设计模式 单例模式"
author: "杰枫 Jeff"
tags: ["PHP", "设计模式"]
date: 2018-10-16T16:11:00+08:00
draft: false
---

### 什么是单例模式？

​	根据这个名称，我们很容易了解到，单例模式指的是在整个应用中**只有一个对象实例**的设计模式。

### 为什么要用单例模式？

​		PHP 常常和数据库打交道，如果在应用中如果频繁建立连接对象，进行 `new` 操作的话，会消耗大料的系统内存资源，这并不是我们希望看到的。再则，在团队合作项目中，单例模式可以有效避免不同程序员 `new` 自己的对象，造成人为的系统消耗。

<!--more-->

### 如何建立单例模式？

​	首先从题目出发，单例模式是**只有一个对象实例**的设计模式。这一点是很让人蛋疼的。我们平常创建的类不是能创建很多对象的，就是不能创建对象的**抽象类**。要创建对象需要有类这是必须的，而且不能是抽象类。这个类要防止别人可以多次创建函数。我们自然而然考虑到了从构造函数入手。但是，每次 `new` 操作都会调用构造函数，也就是会多次创建对象实例。这和我们设计初衷相悖了。在此处务必申明构造函数为 `private` 或者 `protected` 这样才能解决这个问题。

　　构造函数被申明为 `private` 或者 `protected` 这注定无法通过 `new` 的方法创建实例对象了。而且我们发现，经过这一步处理后，解决问题的前景变得明朗起来了。为什么呢？既然无法通过 `new` 方法创建对象实例，那么我们只能通过类内的方法来创建对象实例了。 这个时候我们面临一个有趣的先有鸡还是先有蛋的问题。我们往往是创建了对象后才调用对象的方法，而此时需要调用类里面的方法来创建对象。不受是否创建对象影响都能调用的方法的解决方案毋庸置疑那就是利用关键字 `static`

　　在类内创建静态方法完成完成什么工作呢？回归主题：确保只创建一个实例对象。如何确保只有一个呢？这很简单，`if` 判断一下啊。存在的话直接返回，不存在自己创建一个嘛。当然这个实例对象是类的静态属性。至此，单例模式要求的功能实现完成。真的完成了么? 还不算~ 如果有个类继承本类，将构造方法申明为 `public` 那不又坏事儿了？那有必要在构造方法前加 `final` 关键字了。

```
<?php
class Single{
    public $hash;
    static protected $ins=null;
    final protected function __construct(){
        $this->hash=rand(1,9999);
    }

    static public function getInstance(){
        if (self::$ins instanceof self) {
            return self::$ins;
        }
        self::$ins=new self();
        return self::$ins;
    } 
}
```

　　本身单例模式并不复杂，但需要深入理解。很多初学者依旧会感叹：卧槽，构造方法原来不一直是 `public` 啊~ 卧槽还可以不通过 `new` 创建对象啊~ 

​	其实笔者想说，不管构造方法被申明为 `public`、`private` 还是 `protected`，最终创建对象的时候都会调用。一直是 `new` 创建对象实例，单例模式也用 `new` 创建对象，只是换个地方而已，从类外到类内。